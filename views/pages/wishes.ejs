<!DOCTYPE html>
<html lang="en" class="h-100">
    <head>
        <%- include('../partials/head'); %>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
            rel="stylesheet"
        />
        <link href="css/side-styles.css" rel="stylesheet" />
        <title>üéÅ Game Gifters | Wishes</title>
    </head>

    <body class="d-flex h-100 text-center text-white bg-dark">
        <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
            <%- include('../partials/header'); %>

            <main class="small-box">
                <h2>Wishes</h2>

                <div class="dropdown">
                    <a
                        class="
                            btn
                            my-button
                            fw-bold
                            border-white
                            bg-white
                            dropdown-toggle
                        "
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                    >
                        Select Action
                    </a>

                    <ul
                        class="dropdown-menu"
                        aria-labelledby="dropdownMenuLink"
                    >
                        <li>
                            <a class="dropdown-item" onclick="addEntry()"
                                >Add Wish</a
                            >
                        </li>
                        <li>
                            <a class="dropdown-item" onclick="deleteEntry()"
                                >Delete Wish</a
                            >
                        </li>
                        <li>
                            <a class="dropdown-item" onclick="filter()"
                                >Filter</a
                            >
                        </li>
                    </ul>
                </div>

                <div class="card text-dark bg-light mb-3">
                    <div class="card-header">Wishes / <strong>All</strong></div>

                    <div class="card-body">
                        <div class="data-desc">
                            <h5 class="card-title">üé≤ Wish Database</h5>
                            <p style="font-size: 13px">
                                The following table records a list of wishes
                                made by employees and allows you to add, delete,
                                and filter the entries.
                            </p>
                        </div>

                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Wish ID</th>
                                    <th scope="col">Game ID</th>
                                    <th scope="col">Game Title</th>
                                    <th scope="col">Employee ID</th>
                                    <th scope="col">Employee Name</th>
                                    <th scope="col">Wish Date</th>
                                    <th scope="col">Fulfilled</th>
                                </tr>
                            </thead>
                            <tbody id="wishes-table-body">
                                <% wishes.forEach(function(wish) { %>
                                <tr>
                                    <th scope="row">
                                        <input
                                            class="form-check-input"
                                            type="checkbox"
                                        />
                                    </th>
                                    <td><%= wish.wish_id %></td>
                                    <td><%= wish.game_id %></td>
                                    <td><%= wish.game_title %></td>
                                    <td><%= wish.associated_employee_id %></td>
                                    <td>
                                        <%= wish.first_name + ' ' +
                                        wish.last_name %>
                                    </td>
                                    <td><%= wish.date_wished_formatted %></td>
                                    <td>
                                        <% if (wish.fulfilled) { %>
                                        <span
                                            class="fa fa-check-circle-o green"
                                        ></span
                                        ><span class="ms-1">Yes</span>
                                        <% } else { %>
                                        <span
                                            class="
                                                fa fa-dot-circle-o
                                                text-danger
                                            "
                                        ></span
                                        ><span class="ms-1">No</span>
                                        <% } %>
                                    </td>
                                </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>

            <%- include('../partials/footer'); %>
        </div>

        <!-- Pop-up Form Hidden, Source: https://www.w3schools.com/howto/howto_css_modals.asp -->

        <!-- Add Wish Modal -->
        <div id="modalBox1" class="modal">
            <div class="modal-content form-desc">
                <span class="close" onclick="close1()">&times;</span><br />

                <h2>New Wish</h2>
                <p>Add a new employee wish to the database.</p>
                <br />

                <form id="add-wish-form">
                    <div class="row mb-3" style="padding-top: 1.6em">
                        <div class="form-floating col-md">
                            <select
                                class="form-select"
                                id="employeeID"
                                required
                            >
                                <option value="" selected>
                                    Select an employee
                                </option>
                                <% employees.forEach(function(employee) { %>
                                <option
                                    value="<%= employee.employee_id %>"
                                    data-employee="<%= employee.first_name + ' ' + employee.last_name %>"
                                >
                                    <%= employee.first_name %> <%=
                                    employee.last_name %> [<%=
                                    employee.employee_id %>]
                                </option>
                                <% }); %>
                            </select>
                            <label for="employeeID">Employee</label>
                        </div>
                    </div>

                    <div class="row g-2" style="padding-top: 1.6em">
                        <div class="form-floating col">
                            <select class="form-select" id="gameID" required>
                                <option value="" selected>Select a game</option>
                                <% games.forEach(function(game) { %>
                                <option
                                    value="<%= game.app_id %>"
                                    data-title="<%= game.title %>"
                                >
                                    <%= game.title %> [<%= game.app_id %>]
                                </option>
                                <% }); %>
                            </select>
                            <label for="gameID">Game</label>
                        </div>

                        <div class="form-floating col">
                            <input
                                type="date"
                                class="form-control"
                                id="dateWished"
                                placeholder="Date Wished"
                                required
                            />
                            <label for="dateWished">Wish Date</label>
                        </div>
                    </div>

                    <div class="col-auto" style="padding-top: 3em">
                        <button type="submit" class="btn btn-primary mb-3">
                            Add Wish
                        </button>
                    </div>
                </form>
                <br />
            </div>
        </div>

        <!-- Delete Wish Modal -->
        <div id="modalBox2" class="modal">
            <div class="modal-content form-desc">
                <span class="close" onclick="close2()">&times;</span><br />

                <h2>Remove Wish</h2>
                <p>Are you sure you want to remove the selected Wishes?</p>
                <br />

                <form>
                    <div class="d-grid gap-2 d-md-block">
                        <button
                            class="btn btn-outline-danger"
                            type="button"
                            onclick="close2()"
                        >
                            Yes
                        </button>
                        <button
                            class="btn btn-outline-primary"
                            type="button"
                            onclick="close2()"
                        >
                            No
                        </button>
                    </div>
                </form>
                <br />
            </div>
        </div>

        <!-- Filter Modal -->
        <div id="modalBox3" class="modal">
            <div class="modal-content form-desc">
                <span class="close" onclick="close3()">&times;</span><br />

                <h2>Filter Wishes</h2>
                <p>Enter a whole or partial employee name to search for associated wishes.</p>
                <br />

                <form id="filter-by-name" method="GET" action="/wishes">
                    <div class="row g-2">
                        <div class="form-floating col">
                            <input
                                type="text"
                                class="form-control"
                                id="firstNameSearch"
                                name="firstName"
                                placeholder="John"
                            />
                            <label for="firstNameSearch">First Name</label>
                        </div>
                        <div class="form-floating col">
                            <input
                                type="text"
                                class="form-control"
                                id="lastNameSearch"
                                name="lastName"
                                placeholder="Smith"
                            />
                            <label for="lastNameSearch">Last Name</label>
                        </div>
                    </div>

                    <div class="col-auto" style="padding-top: 3em">
                        <button type="submit" class="btn btn-primary mb-3">
                            Search
                        </button>
                    </div>
                </form>
                <br />
            </div>
        </div>

        <!-- Bootstrap Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/script.js"></script>
        <script src="js/addWish.js"></script>
        <script src="js/convertDateString.js"></script>

        <!-- Custom Scripts -->
        <script>
            function deleteEntry() {
                // user clicks on action button
                document.getElementById("modalBox2").style.display = "block";
            }

            document.querySelector("#dateWished").valueAsDate = new Date();
        </script>
    </body>
</html>
